<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Project Clipboard</title>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 2rem 0;
        }

        .container {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 800px;
            width: 90%;
        }

        h1 {
            color: #333;
            margin-top: 0;
        }

        p {
            color: #666;
            margin-bottom: 2rem;
        }

        .button-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        @media (min-width: 600px) {
            .button-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        @media (min-width: 800px) {
            .button-grid {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }

        .copy-btn {
            padding: 0.8rem 1.2rem;
            font-size: 1rem;
            font-weight: 600;
            color: #ffffff;
            background-color: #007bff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .copy-btn:hover {
            background-color: #0056b3;
        }

        .copy-btn:active {
            transform: scale(0.98);
        }

        .copy-btn.copied {
            background-color: #28a745;
        }

        /* This CSS rule hides the code storage */
        #code-storage {
            display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Java Shop System</h1>
        <p>Click a button to copy the contents of the file to your clipboard.</p>
        
        <div class="button-grid">
            <button class="copy-btn" data-code-id="1">User.java</button>
            <button class="copy-btn" data-code-id="2">Product.java</button>
            <button class="copy-btn" data-code-id="3">Main.java</button>
            <button class="copy-btn" data-code-id="4">InputCatcher.java</button>
            <button class="copy-btn" data-code-id="5">ProductList.java</button>
            <button class="copy-btn" data-code-id="6">FileHandling.java</button>
            <button class="copy-btn" data-code-id="7">ShopSystem.java</button>
        </div>
    </div>

    <div id="code-storage">

        <textarea id="code-1">
import java.io.*;
import java.util.*;

public class User implements Serializable {
    private String userName;
    private String personName;
    private CustomerData customerData;
    private SellerData sellerData;

    public User(String userName, String personName) {
        if (userName == null || userName.isEmpty()) {
            throw new IllegalArgumentException("Username cannot be null or empty");
        }
        this.userName = userName;
        this.personName = (personName != null) ? personName : "";
        this.customerData = null; 
        this.sellerData = null;
    }

    public void enableCustomerRole() {
        if (this.customerData == null) {
            this.customerData = new CustomerData();
        }
    }
    
    public void enableSellerRole() {
        if (this.sellerData == null) {
            this.sellerData = new SellerData();
        }
    }

    public boolean isCustomer() {
        return this.customerData != null;
    }

    public boolean isSeller() {
        return this.sellerData != null;
    }

    public String getPersonName() {
        return personName;
    }

    public void setPersonName(String personName) {
        this.personName = personName;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }
    
    public CustomerData getCustomerData() {
        if (!isCustomer()) {
            throw new IllegalStateException("User is not a Customer");
        }
        return customerData;
    }

    public void setCustomerData(CustomerData customerData) {
        this.customerData = customerData;
    }

    public SellerData getSellerData() {
        if (!isSeller()) {
            throw new IllegalStateException("User is not a Seller");
        }
        return sellerData;
    }

    public void setSellerData(SellerData sellerData) {
        this.sellerData = sellerData;
    }

    public static class CustomerData implements Serializable {
        private static final long serialVersionUID = 1L;
        private final List<String> purchaseHistory = new ArrayList<>();
        private final Map<Integer, Integer> cart = new HashMap<>();

        public List<String> getPurchaseHistory() {
            return purchaseHistory;
        }
        
        public Map<Integer, Integer> getCart() {
            return cart;
        }

        public void addToCart(int productId, int quantity) {
            if (quantity <= 0) {
                cart.remove(productId);
            } else {
                cart.put(productId, quantity);
            }
        }

        public void clearCart() {
            cart.clear();
        }
    }

    public static class SellerData implements Serializable {
        private static final long serialVersionUID = 1L;
        private final List<String> productListings = new ArrayList<>();

        public List<String> getProductListings() {return productListings;}
    }

    @Override
    public String toString() {
        return String.format(
                "User[userName=%s, personName=%s, isCustomer=%b, isSeller=%b]",
                userName, personName, isCustomer(), isSeller()
        );
    }
}
        </textarea>
        
        <textarea id="code-2">
public class Product {
    private static int nextId = 1;

    private int productId;
    private String productName;
    private double productInitPrice;
    private double productDiscount;
    private double productFinalPrice;
    private int productQuantity;
    private String sellerName;
    private boolean deleted = false;

    public Product(String productName, double productInitPrice, int productQuantity, String sellerName) {
        this.productId = nextId++;
        this.productName = productName;
        this.productInitPrice = productInitPrice;
        this.productQuantity = productQuantity;
        this.sellerName = sellerName;
        this.productDiscount = 0.0;
        this.productFinalPrice = productInitPrice * (1 - productDiscount);
    }

    public Product(int productId, String productName, double productInitPrice, double productDiscount, int productQuantity, String sellerName) {
        this.productId = productId;
        this.productName = productName;
        this.productInitPrice = productInitPrice;
        this.productDiscount = productDiscount;
        this.productFinalPrice = productInitPrice * (1 - productDiscount);
        this.productQuantity = productQuantity;
        this.sellerName = sellerName;
    }

    public int getProductId() { return productId; }
    public String getProductName() { return productName; }
    public double getProductFinalPrice() { return productFinalPrice; }
    public double getProductDiscount() { return productDiscount; }
    public double getProductInitPrice() { return productInitPrice; }
    public int getProductQuantity() { return productQuantity; }
    public String getSellerName() { return sellerName; }
    public boolean isDeleted() { return deleted; } 

    public static void setNextId(int next) { 
        nextId = next;
    }

    public void updQty(int productQuantity) { this.productQuantity = productQuantity; }

    public void updName(String productName) { this.productName = productName; }

    public void updInitPrice(double productInitPrice) {
        this.productInitPrice = productInitPrice;
        this.productFinalPrice = productInitPrice * (1 - productDiscount);
    }

    public void updDiscount(double productDiscount) {
        this.productDiscount = productDiscount;
        this.productFinalPrice = productInitPrice * (1 - productDiscount);
    }

    public void delProduct() {
        this.productName = null;
        this.productInitPrice = 0.0;
        this.sellerName = null;
        this.productQuantity = 0;
        this.productDiscount = 0.0;
        this.deleted = true;
    }
}
        </textarea>
        
        <textarea id="code-3">
public class Main {
    public static void main(String[] args) {
        ShopSystem shopsys = new ShopSystem();
        shopsys.mainDashboard();
    }
}
        </textarea>
        
        <textarea id="code-4">
import java.util.Scanner;

public class InputCatcher {
    private static final Scanner sc = new Scanner(System.in);

    public static int getInt(String prompt) {
        while (true) {
            System.out.print(prompt);
            try {
                String s = sc.nextLine();
                return Integer.parseInt(s.trim());
            } catch (NumberFormatException e) {
                System.out.println("Invalid input, please enter an integer.");
            }
        }
    }

    public static float getFloat(String prompt) {
        while (true) {
            System.out.print(prompt);
            try {
                String s = sc.nextLine();
                return Float.parseFloat(s.trim());
            } catch (NumberFormatException e) {
                System.out.println("Invalid input, please enter a float.");
            }
        }
    }

    public static String getString(String prompt) {
        System.out.print(prompt);
        return sc.nextLine();
    }
}
        </textarea>
        
        <textarea id="code-5">
import java.util.*;

public class ProductList {
    protected List<Product> products;

    protected void tileFormat(Product p) {
        System.out.println("--------------------------------------");
        System.out.printf("| ID: %-31d |\n", p.getProductId());
        System.out.printf("| %-36s |\n", p.getProductName());
        
        if (p.getProductDiscount() > 0) {
            System.out.printf("| Price: Php %.2f (%.0f%% off)      |\n", p.getProductFinalPrice(), p.getProductDiscount() * 100);
            System.out.printf("| (Was Php %.2f)                   |\n", p.getProductInitPrice());
        } else {
            System.out.printf("| Price: Php %-24.2f |\n", p.getProductFinalPrice());
        }
        
        System.out.printf("| Stock: %-28d |\n", p.getProductQuantity());
        System.out.printf("| Seller: %-27s |\n", p.getSellerName());
        System.out.println("--------------------------------------");
    }

    public ProductList() { this.products = new ArrayList<>(); } 

    public void showAll() {
        boolean found = false;
        for (Product p : products) {
            if (p.isDeleted() == false && p.getProductQuantity() > 0) {
                tileFormat(p);
                found = true;
            }
        }
        if (!found) {
            System.out.println("No products available.");
        }
    }

    public void showOne(int id) {
        for (Product p : products) {
            if (p.getProductId() == id) {
                tileFormat(p);
                return;
            }
        }
    }
}

class CartList extends ProductList {
    private List<Product> cartItems = new ArrayList<>();

    public CartList(List<Product> products) {
        this.products = products;
    }
    
    public List<Product> getCartItems() { 
        return cartItems;
    }
    
    public boolean isEmpty() { 
        return cartItems.isEmpty();
    }
    
    public void clearCart() { 
        cartItems.clear();
    }

    public void addToCart(int id, int qty) {
        for (Product item : cartItems) {
            if (item.getProductId() == id) {
                item.updQty(item.getProductQuantity() + qty);
                return;
            }
        }
        
        for (Product p : products) {
            if (p.getProductId() == id) {
                Product cartItem = new Product(
                    p.getProductId(),
                    p.getProductName(),
                    
                    p.getProductInitPrice(), 
                    p.getProductDiscount(),
                    qty,
                    p.getSellerName()
                );
                cartItems.add(cartItem);
                return;
            }
        }
    }

    @Override
    protected void tileFormat(Product p) {
        System.out.println("--------------------------------------");
        System.out.printf("| %-36s |\n", p.getProductName());
        System.out.printf("| Qty: %-30d |\n", p.getProductQuantity()); 
        System.out.printf("| Price: Php %-24.2f |\n", p.getProductFinalPrice());
        System.out.printf("| Subtotal: Php %-21.2f |\n", p.getProductFinalPrice() * p.getProductQuantity());
        System.out.println("--------------------------------------");
    }

    @Override
    public void showAll() {
        if (cartItems.isEmpty()) {
            System.out.println("Your cart is empty.");
            return;
        }
        for (Product p : cartItems) {
            tileFormat(p);
        }
    }
}

class StoreList extends ProductList {
    public StoreList(List<Product> products) {
        this.products = products;
    }

    public void showStore(User u) {
        boolean found = false;
        for (Product p : products) {
            if (p.isDeleted() == false && p.getSellerName().equals(u.getUserName())) {
                tileFormat(p);
                found = true;
            }
        }
        if (!found) {
            System.out.println("You have no products listed.");
        }
    }

    public void addProduct(Product p) { products.add(p); }

    public void delProduct(int id_to_del) {
        for (Product p : products) {
            if (p.getProductId() == id_to_del) {
                p.delProduct();
            }
        }
    }
}
        </textarea>
        
        <textarea id="code-6">
import java.io.*;
import java.util.*;

public class FileHandling {
    private final List<Product> products = new ArrayList<>();
    private final Map<String, User> users = new HashMap<>();

    public List<Product> getProducts() { return products; }

    public FileHandling() {
        dataFolders();
    }

    private void dataFolders() {
        new File("data").mkdirs();
    }

    public Product findProductByID(int id) {
        for (Product p : products) {
            if (p.getProductId() == id) return p;
        }
        return null;
    }

    public void registerUser(String userName, String personName, String role) {
        User user = users.get(userName); 
        if (user == null) {
            user = new User(userName, personName);
            users.put(userName, user);
        } else {
            
            user.setPersonName(personName);
        }
        
        
        if (role.equals("Customer")) {
            user.enableCustomerRole();
        } else if (role.equals("Seller")) {
            user.enableSellerRole();
        }
    }

    public User loginUser(String userName) {
        return users.getOrDefault(userName, null);
    }

    public void loadAllData() {  
        products.clear();
        users.clear();
        
        loadProduct();
        loadBuyerData();
        loadSellerData();
        loadCartData(); 
    }

    public void saveAllData() { 
        saveProduct();
        saveBuyerData();
        saveSellerData();
        saveCartData(); 
    }

    public void saveProduct() { 
        try (BufferedWriter writer = new BufferedWriter(new FileWriter("data/products.txt"))) {
            for (Product p : products) {
                writer.write(p.getProductId() + "," +
                        p.getProductName() + "," +
                        p.getProductInitPrice() + "," +
                        p.getProductDiscount() + "," +
                        p.getProductQuantity() + "," +
                        p.getSellerName() + "," +
                        p.isDeleted());
                writer.newLine();
            }
        } catch (IOException e) {
            e.printStackTrace(System.out);
        }
    }

    public void loadProduct() { 
        File file = new File("data/products.txt");
        if (!file.exists()) return;
        
        products.clear();
        int maxId = 0;

        try (BufferedReader reader = new BufferedReader(new FileReader(file))) {
            String line;
            while ((line = reader.readLine()) != null) {
                String[] parts = line.split(",");
                if (parts.length == 7) {
                    int productId = Integer.parseInt(parts[0]);
                    String productName = parts[1];
                    double productInitPrice = Double.parseDouble(parts[2]);
                    double productDiscount = Double.parseDouble(parts[3]);
                    int productQuantity = Integer.parseInt(parts[4]);
                    String sellerName = parts[5];
                    boolean deleted = Boolean.parseBoolean(parts[6]);

                    Product product = new Product(productId, productName, productInitPrice, productDiscount, productQuantity, sellerName);
                    if (deleted) {
                        product.delProduct();
                    }
                    products.add(product);

                    if (productId > maxId) {
                        maxId = productId;
                    }
                }
            }
        } catch (IOException | NumberFormatException e) {
            System.out.println("Error loading product data. File might be corrupt.");
            e.printStackTrace(System.out);
        }
        
        Product.setNextId(maxId + 1);
    }

    public void saveBuyerData() { 
        try (BufferedWriter writer = new BufferedWriter(new FileWriter("data/buyers.txt"))) {
            for (User user : users.values()) {
                if (user.isCustomer()) {
                    writer.write(user.getUserName() + "," +
                            user.getPersonName() + "," +
                            "Customer");
                    writer.newLine();
                }
            }
        } catch (IOException e) {
            e.printStackTrace(System.out);
        }
    }


    public void loadBuyerData() { 
        File file = new File("data/buyers.txt");
        if (!file.exists()) return;

        try (BufferedReader reader = new BufferedReader(new FileReader(file))) {
            String line;
            while ((line = reader.readLine()) != null) {
                String[] parts = line.split(",");
                if (parts.length >= 3) {
                    String userName = parts[0];
                    String personName = parts[1];
                    String role = parts[2];
                    registerUser(userName, personName, role);
                }
            }
        } catch (IOException e) {
            e.printStackTrace(System.out);
        }
    }

    public void saveSellerData() { 
        try (BufferedWriter writer = new BufferedWriter(new FileWriter("data/sellers.txt"))) {
            for (User user : users.values()) {
                if (user.isSeller()) {
                    writer.write(user.getUserName() + "," +
                            user.getPersonName() + "," +
                            "Seller");
                    writer.newLine();
                }
            }
        } catch (IOException e) {
            e.printStackTrace(System.out);
        }
    }


    public void loadSellerData() {
        File file = new File("data/sellers.txt");
        if (!file.exists()) return;

        try (BufferedReader reader = new BufferedReader(new FileReader(file))) {
            String line;
            while ((line = reader.readLine()) != null) {
                String[] parts = line.split(",");
                if (parts.length >= 3) {
                    String userName = parts[0];
                    String personName = parts[1];
                    String role = parts[2];
                    registerUser(userName, personName, role);
                }
            }
        } catch (IOException e) {
            e.printStackTrace(System.out);
        }
    }

    public void saveCartData() { 
        try (BufferedWriter writer = new BufferedWriter(new FileWriter("data/carts.txt"))) {
            for (User user : users.values()) {
                if (user.isCustomer()) {
                    Map<Integer, Integer> cart = user.getCustomerData().getCart();
                    for (Map.Entry<Integer, Integer> entry : cart.entrySet()) {
                        writer.write(user.getUserName() + "," +
                                entry.getKey() + "," +
                                entry.getValue());
                        writer.newLine();
                    }
                }
            }
        } catch (IOException e) {
            e.printStackTrace(System.out);
        }
    }

    public void loadCartData() { 
        File file = new File("data/carts.txt");
        if (!file.exists()) return; 

        try (BufferedReader reader = new BufferedReader(new FileReader(file))) {
            String line;
            while ((line = reader.readLine()) != null) {
                String[] parts = line.split(",");
                if (parts.length == 3) {
                    String userName = parts[0];
                    int productId = Integer.parseInt(parts[1]);
                    int quantity = Integer.parseInt(parts[2]);

                    User user = users.get(userName);
                    
                    if (user != null && user.isCustomer()) {
                        Product p = findProductByID(productId);
                        if (p != null && !p.isDeleted()) {
                            user.getCustomerData().addToCart(productId, quantity);
                        }
                    }
                }
            }
        } catch (IOException | NumberFormatException e) {
            System.out.println("Error loading cart data. File might be corrupt.");
            e.printStackTrace(System.out);
        }
    }
}
        </textarea>
        
        <textarea id="code-7">
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

public class ShopSystem {
    FileHandling file = new FileHandling();

    public void mainDashboard() {
        file.loadAllData();
        int choice;
        do {
            System.out.println("\n=== Main Dashboard ===");
            System.out.println("[1] Buyer Dashboard");
            System.out.println("[2] Seller Dashboard");
            System.out.println("[0] Exit Program");
            choice = InputCatcher.getInt("Choice: ");

            switch (choice) {
                case 1 -> { 
                    int subChoice;
                    System.out.println("\n=== Buyer Dashboard ===");
                    System.out.println("[1] Register");
                    System.out.println("[2] Login");
                    System.out.println("[0] Go back to Main Dashboard");
                    subChoice = InputCatcher.getInt("Choice: ");

                    switch (subChoice) {
                        case 1 -> { 
                            System.out.println("Enter your details to register as a Buyer");
                            String userName = InputCatcher.getString("Username: ");
                            String personName = InputCatcher.getString("Person Name: ");
                            
                            file.registerUser(userName, personName, "Customer");
                            file.saveBuyerData();
                            System.out.println("Buyer registration successful! You can now login.");
                        }

                        case 2 -> { 
                            System.out.println("Enter your username to login");
                            String userName = InputCatcher.getString("Username: ");
                            User loggedInUser = file.loginUser(userName);

                            if (loggedInUser != null && loggedInUser.isCustomer()) {
                                System.out.println("Login successful! Welcome, " + loggedInUser.getPersonName());
                                buyerDashBoard(loggedInUser); 
                            } else {
                                System.out.println("Login failed! User not found or is not registered as a buyer.");
                            }
                        }

                        case 0 -> { 
                            System.out.println("Returning to Main Dashboard...");
                            break;
                        }

                        default -> System.out.println("Invalid choice. Please try again.");
                    }
                }

                case 2 -> { 
                    int subChoice;
                    System.out.println("\n=== Seller Dashboard ===");
                    System.out.println("[1] Register");
                    System.out.println("[2] Login");
                    System.out.println("[0] Go back to Main Dashboard");
                    subChoice = InputCatcher.getInt("Choice: ");
                    switch (subChoice) {
                        case 1 -> { 
                            System.out.println("Enter your details to register as a Seller");
                            String userName = InputCatcher.getString("Username: ");
                            String personName = InputCatcher.getString("Person Name: ");

                            file.registerUser(userName, personName, "Seller");
                            file.saveSellerData();
                            System.out.println("Seller registration successful! You can now login.");
                        }

                        case 2 -> { 
                            System.out.println("Enter your username to login");
                            String userName = InputCatcher.getString("Username: ");
                            User loggedInUser = file.loginUser(userName);
                            
                            if (loggedInUser != null && loggedInUser.isSeller()) {
                                System.out.println("Login successful! Welcome, " + loggedInUser.getPersonName());
                                sellerDashBoard(loggedInUser); 
                            } else {
                                System.out.println("Login failed! User not found or is not registered as a seller.");
                            }
                        }

                        case 0 -> { 
                            System.out.println("Returning to Main Dashboard...");
                            break;
                        }

                        default -> System.out.println("Invalid choice. Please try again.");
                    }
                }
            }
        } while (choice != 0);

        file.saveAllData(); 
        System.out.println("Exiting program. Goodbye!");
    }


    public void sellerDashBoard(User seller) { 
        StoreList storeList = new StoreList(file.getProducts());
        int choice;
        do {
            System.out.println("\n=== Seller Dashboard for " + seller.getPersonName() + " ===");
            System.out.println("[1] Add Product");
            System.out.println("[2] Update product name");
            System.out.println("[3] Update product price");
            System.out.println("[4] Update product stock");
            System.out.println("[5] Remove item");
            System.out.println("[8] View My Products");
            System.out.println("[9] Go Back to Main Dashboard");
            System.out.println("[0] Exit Program");
            choice = InputCatcher.getInt("Choice: ");

            switch (choice) {
                case 1 -> { 
                    System.out.println("Enter new product details:");
                    String name = InputCatcher.getString("Product Name: ");
                    double price = InputCatcher.getFloat("Product Price: ");
                    int stock = InputCatcher.getInt("Product Stock: ");
                    Product newProduct = new Product(name, price, stock, seller.getUserName());
                    storeList.addProduct(newProduct);
                    file.saveProduct(); 
                    System.out.println("Product added successfully! ID: " + newProduct.getProductId());
                }

                case 2 -> { 
                    storeList.showStore(seller); 
                    int id = InputCatcher.getInt("Enter Product ID to update name: ");
                    Product p = file.findProductByID(id);
                    if (p != null && p.getSellerName().equals(seller.getUserName()) && !p.isDeleted()) {
                        String newName = InputCatcher.getString("Enter new name: ");
                        p.updName(newName);
                        file.saveProduct();
                        System.out.println("Product name updated.");
                    } else {
                        System.out.println("Invalid ID or product does not belong to you.");
                    }
                }

                case 3 -> { 
                    storeList.showStore(seller);
                    int id = InputCatcher.getInt("Enter Product ID to update price: ");
                    Product p = file.findProductByID(id);
                    if (p != null && p.getSellerName().equals(seller.getUserName()) && !p.isDeleted()) {
                        float newPrice = InputCatcher.getFloat("Enter new price: ");
                        p.updInitPrice(newPrice);
                        file.saveProduct();
                        System.out.println("Product price updated.");
                    } else {
                        System.out.println("Invalid ID or product does not belong to you.");
                    }
                }

                case 4 -> { 
                    storeList.showStore(seller);
                    int id = InputCatcher.getInt("Enter Product ID to update stock: ");
                    Product p = file.findProductByID(id);
                    if (p != null && p.getSellerName().equals(seller.getUserName()) && !p.isDeleted()) {
                        int newStock = InputCatcher.getInt("Enter new stock: ");
                        p.updQty(newStock);
                        file.saveProduct();
                        System.out.println("Product stock updated.");
                    } else {
                        System.out.println("Invalid ID or product does not belong to you.");
                    }
                }

                case 5 -> { 
                    storeList.showStore(seller);
                    int id = InputCatcher.getInt("Enter Product ID to remove: ");
                    Product p = file.findProductByID(id);
                    if (p != null && p.getSellerName().equals(seller.getUserName()) && !p.isDeleted()) {
                        p.delProduct(); 
                        file.saveProduct();
                        System.out.println("Product removed.");
                    } else {
                        System.out.println("Invalid ID or product does not belong to you.");
                    }
                }
                
                case 8 -> { 
                    System.out.println("\n--- Your Products ---");
                    storeList.showStore(seller);
                }

                case 9 -> { 
                    System.out.println("Returning to main dashboard...");
                    return; 
                }

                case 0 -> { 
                    System.out.println("Exiting program. Goodbye!");
                    file.saveAllData(); 
                    System.exit(0); 
                }

                default -> System.out.println("Invalid choice. Please try again.");
            }
        } while (true);
    }

    private void saveCartToUser(User buyer, CartList cart) {
        if (buyer.isCustomer()) {
            User.CustomerData data = buyer.getCustomerData();
            data.clearCart();
            
            for (Product p : cart.getCartItems()) {
                data.addToCart(p.getProductId(), p.getProductQuantity());
            }
        }
    }

    public void buyerDashBoard(User buyer) {
        ProductList allProducts = new ProductList();
        allProducts.products = file.getProducts();
        CartList myCart = new CartList(file.getProducts());

        System.out.println("Loading your saved cart...");
        Map<Integer, Integer> savedCart = buyer.getCustomerData().getCart();
        List<Integer> idsToRemove = new ArrayList<>(); 
        
        for (Map.Entry<Integer, Integer> entry : savedCart.entrySet()) {
            int productId = entry.getKey();
            int quantity = entry.getValue();
            Product p = file.findProductByID(productId);
            
            if (p != null && !p.isDeleted() && p.getProductQuantity() > 0) {
                if (quantity > p.getProductQuantity()) {
                    System.out.println("Note: Quantity for '" + p.getProductName() + 
                                       "' reduced to " + p.getProductQuantity() + " (max stock).");
                    quantity = p.getProductQuantity(); 
                    entry.setValue(quantity); 
                }
                myCart.addToCart(productId, quantity); 
            } else {
                idsToRemove.add(productId);
            }
        }
        
        for (int id : idsToRemove) {
            savedCart.remove(id);
            System.out.println("Note: An item from your saved cart is no longer available and has been removed.");
        }

        int choice;
        do {
            System.out.println("\n=== Buyer Dashboard for " + buyer.getPersonName() + " ===");
            System.out.println("[1] View All Products & Buy");
            System.out.println("[2] View Cart & Checkout");
            System.out.println("[9] Go Back to Main Dashboard");
            System.out.println("[0] Exit Program");
            choice = InputCatcher.getInt("Choice: ");

            switch (choice) {
                case 1 -> { 
                    System.out.println("\n--- All Products ---");
                    allProducts.showAll();
                    String buyChoice = InputCatcher.getString("Enter Product ID to buy (or 'M' to return to menu): ");
                    
                    if (buyChoice.equalsIgnoreCase("M")) {
                        break; 
                    }
                    
                    try {
                        int id = Integer.parseInt(buyChoice);
                        Product p = file.findProductByID(id);
                        
                        if (p != null && !p.isDeleted()) {
                            int qty = InputCatcher.getInt("Enter quantity: ");
                            if (qty > 0 && qty <= p.getProductQuantity()) {
                                myCart.addToCart(id, qty);
                                System.out.println(p.getProductName() + " added to cart.");
                            } else {
                                System.out.println("Invalid quantity or not enough stock.");
                            }
                        } else {
                            System.out.println("Invalid Product ID.");
                        }
                    } catch (NumberFormatException e) {
                        System.out.println("Invalid input.");
                    }
                }

                case 2 -> { 
                    System.out.println("\n--- Your Cart ---");
                    myCart.showAll();
                    if (myCart.isEmpty()) {
                        break; 
                    }
                    
                    double total = 0;
                    for (Product p : myCart.getCartItems()) {
                        total += p.getProductFinalPrice() * p.getProductQuantity();
                    }
                    System.out.printf("Total Price: Php %.2f\n", total);
                    
                    String checkoutChoice = InputCatcher.getString("Proceed to checkout? (y/n): ");
                    if (checkoutChoice.equalsIgnoreCase("y")) {
                        boolean stockError = false;
                        
                        for (Product p_cart : myCart.getCartItems()) {
                            Product p_store = file.findProductByID(p_cart.getProductId());
                            if (p_store == null || p_store.isDeleted() || p_cart.getProductQuantity() > p_store.getProductQuantity()) {
                                System.out.println("Error: " + p_cart.getProductName() + " is no longer available in this quantity.");
                                stockError = true;
                            }
                        }

                        if (!stockError) {
                            for (Product p_cart : myCart.getCartItems()) {
                                Product p_store = file.findProductByID(p_cart.getProductId());
                                int newStock = p_store.getProductQuantity() - p_cart.getProductQuantity();
                                p_store.updQty(newStock);
                            }
                            file.saveProduct(); 
                            myCart.clearCart(); 
                            
                            saveCartToUser(buyer, myCart);
                            file.saveCartData(); 

                            System.out.println("Checkout successful! Thank you for your purchase.");
                        } else {
                            System.out.println("Checkout failed. Please review your cart.");
                        }
                    }
                }

                case 9 -> { 
                    System.out.println("Returning to main dashboard... Saving cart...");
                    saveCartToUser(buyer, myCart);
                    file.saveCartData(); 
                    return; 
                }

                case 0 -> { 
                    System.out.println("Exiting program... Saving cart... Goodbye!");
                    saveCartToUser(buyer, myCart);
                    file.saveAllData(); 
                    System.exit(0); 
                }

                default -> System.out.println("Invalid choice. Please try again.");
            }
        } while (true);
    }
}
        </textarea>

    </div>


    <script>
        // --- Logic to make the buttons work ---

        // 1. Get all the buttons
        const copyButtons = document.querySelectorAll('.copy-btn');

        // 2. Add a click event listener to each button
        copyButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Get the ID from the button's 'data-code-id' attribute
                const codeId = button.dataset.codeId;
                
                // Find the matching textarea by its ID (e.g., "code-1")
                const codeTextarea = document.getElementById('code-' + codeId);

                if (codeTextarea) {
                    // Get the raw text value from the textarea
                    const codeToCopy = codeTextarea.value;

                    // Use the Clipboard API to copy the text
                    navigator.clipboard.writeText(codeToCopy)
                        .then(() => {
                            // --- Give user feedback ---
                            const originalText = button.textContent;
                            
                            // Reset other buttons
                            copyButtons.forEach(btn => {
                                if (btn.classList.contains('copied')) {
                                    btn.textContent = btn.dataset.originalText || btn.textContent;
                                    btn.classList.remove('copied');
                                }
                                // Store original text if not already stored
                                if (!btn.dataset.originalText) {
                                    btn.dataset.originalText = btn.textContent;
                                }
                            });

                            // Set this button to 'Copied!'
                            button.textContent = 'Copied!';
                            button.classList.add('copied');
                            button.dataset.originalText = originalText; // Store its original text

                            // Change it back after 2 seconds
                            setTimeout(() => {
                                button.textContent = originalText;
                                button.classList.remove('copied');
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('Failed to copy text: ', err);
                            const originalText = button.dataset.originalText || button.textContent;
                            button.textContent = 'Copy Failed!';
                            setTimeout(() => {
                                button.textContent = originalText;
                            }, 2000);
                        });
                } else {
                    console.error('Could not find code textarea for ID: ' + codeId);
                }
            });
        });
    </script>

</body>
</html>
